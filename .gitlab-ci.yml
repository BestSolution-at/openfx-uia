
stages:
  - build
  - deploy

build:
  stage: build
  before_script:
    - |
      if (-not (Test-Path "$pwd\java\zulu8.54.0.21-ca-fx-jdk8.0.292-win_x64")) {
        echo "Downloading Java 8 JDK+FX"
        $global:ProgressPreference = 'SilentlyContinue'
        Invoke-WebRequest -Verbose -Uri http://p2.ci.bestsolution.at/jdks/win64/zulu8.54.0.21-ca-fx-jdk8.0.292-win_x64.zip -OutFile jdk8fx.zip
        echo "Extracting..."
        Expand-Archive jdk8fx.zip -DestinationPath java
      }
      $env:JAVA_HOME = "$pwd\java\zulu8.54.0.21-ca-fx-jdk8.0.292-win_x64"
    - Import-Module "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\Common7\Tools\Microsoft.VisualStudio.DevShell.dll"
    - Enter-VsDevShell -VsInstallPath "C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools"
  script:
    - ./gradlew --no-daemon assemble
  tags:
    - win64
  artifacts:
    untracked: true
    expire_in: 10 mins


deploy_snapshot:
  stage: deploy
  only:
    - master
  script:
    - echo "Running deploy_snapshot for master"
    - mvn -version
    - ls UIAPlatform/build/libs/UIAPlatform.jar
    - ls UIAPlatform/build/libs/UIAPlatform-sources.jar
    - ls UIAPlatform/build/libs/UIAPlatform-javadoc.jar
    - ls UIAPlatform.sample/build/libs/UIAPlatform.sample.jar
    - ls UIAPlatform.sample/build/libs/launcher.jar
  tags:
    - deploy-mvn

deploy_release:
  stage: deploy
  only:
    - /^r[0-9]+[.][0-9]+[.][0-9]+(-[a-z0-9]+)?$/
  script:
    - echo "Running deploy_release for $CI_COMMIT_TAG"
    - mvn -version
    - ls UIAPlatform/build/libs/UIAPlatform.jar
    - ls UIAPlatform/build/libs/UIAPlatform-sources.jar
    - ls UIAPlatform/build/libs/UIAPlatform-javadoc.jar
    - ls UIAPlatform.sample/build/libs/UIAPlatform.sample.jar
    - ls UIAPlatform.sample/build/libs/launcher.jar
  tags:
   - deploy-mvn
